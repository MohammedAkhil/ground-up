{
  "version": 3,
  "sources": ["../src/caffeinateUntil.ts", "../src/utils.ts"],
  "sourcesContent": ["import { showToast, Toast } from \"@raycast/api\";\nimport { startCaffeinate } from \"./utils\";\n\nexport default async function Command(props: { arguments: Arguments.CaffeinateUntil }) {\n  const { time } = props.arguments;\n  const pattern = /^(\\d{1,2})(?::(\\d\\d))? *(am|pm)?$/i;\n\n  if (!pattern.test(time)) {\n    await showToast(Toast.Style.Failure, \"Unrecognized time format\");\n    return;\n  }\n\n  const [, hourStr, minuteStr, ampm] = pattern.exec(time) ?? [];\n  const inputHour = Number(hourStr);\n  let hour = inputHour;\n  if (ampm?.toLowerCase() == \"pm\" && inputHour < 12) hour += 12;\n  if (ampm?.toLowerCase() == \"am\" && inputHour == 12) hour = 0;\n  const minute = minuteStr ? Number(minuteStr) : 0;\n\n  if (hour < 0 || hour > 24 || minute < 0 || minute > 59) {\n    await showToast(Toast.Style.Failure, \"Unrecognized time format\");\n    return;\n  }\n\n  const now = new Date();\n  const target = new Date();\n  target.setHours(hour);\n  target.setMinutes(minute);\n  target.setSeconds(0);\n\n  // If we have ampm or a 24-hour time, assume it's explicit and use the next day.\n  // Otherwise, find the next occurrence of the given 12-hour time.\n  const is24h = ampm || hour > 12 || hourStr.startsWith(\"0\");\n  while (target <= now) {\n    target.setHours(target.getHours() + (is24h ? 24 : 12));\n  }\n\n  const totalSeconds = (target.getTime() - now.getTime()) / 1000;\n  const formattedTime = target.toLocaleTimeString([], { timeStyle: \"short\" });\n  const tomorrow = target.getDate() != now.getDate() ? \"tomorrow at \" : \"\";\n\n  await startCaffeinate(\n    { menubar: true, status: true },\n    `Caffeinating your Mac until ${tomorrow}${formattedTime}`,\n    `-t ${totalSeconds}`,\n  );\n}\n", "import { getPreferenceValues, launchCommand, LaunchType, LocalStorage, showHUD } from \"@raycast/api\";\nimport { exec, execSync } from \"node:child_process\";\n\ntype Preferences = {\n  preventDisplay: boolean;\n  preventDisk: boolean;\n  preventSystem: boolean;\n  icon: string;\n};\n\ntype Updates = {\n  menubar: boolean;\n  status: boolean;\n};\n\nexport interface Schedule {\n  day: string;\n  from: string;\n  to: string;\n  IsManuallyDecafed: boolean;\n  IsRunning: boolean;\n}\n\nexport async function startCaffeinate(updates: Updates, hudMessage?: string, additionalArgs?: string) {\n  if (hudMessage) {\n    await showHUD(hudMessage);\n  }\n  await stopCaffeinate({ menubar: false, status: false });\n  exec(`/usr/bin/caffeinate ${generateArgs(additionalArgs)} || true`);\n  await update(updates, true);\n}\n\nexport async function stopCaffeinate(updates: Updates, hudMessage?: string) {\n  if (hudMessage) {\n    await showHUD(hudMessage);\n  }\n  execSync(\"/usr/bin/killall caffeinate || true\");\n  await update(updates, false);\n}\n\nasync function update(updates: Updates, caffeinated: boolean) {\n  if (updates.menubar) {\n    await tryLaunchCommand(\"index\", { caffeinated });\n  }\n  if (updates.status) {\n    await tryLaunchCommand(\"status\", { caffeinated });\n  }\n}\n\nasync function tryLaunchCommand(commandName: string, context: { caffeinated: boolean }) {\n  try {\n    await launchCommand({ name: commandName, type: LaunchType.Background, context });\n  } catch (error) {\n    // Handle error if command is not enabled\n  }\n}\n\nfunction generateArgs(additionalArgs?: string) {\n  const preferences = getPreferenceValues<Preferences>();\n  const args = [];\n\n  if (preferences.preventDisplay) args.push(\"d\");\n  if (preferences.preventDisk) args.push(\"m\");\n  if (preferences.preventSystem) args.push(\"i\");\n  if (additionalArgs) args.push(` ${additionalArgs}`);\n\n  return args.length > 0 ? `-${args.join(\"\")}` : \"\";\n}\n\nexport function numberToDayString(dayIndex: number): string {\n  const daysOfWeek = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n  return daysOfWeek[dayIndex];\n}\n\nexport async function getSchedule() {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  const getSchedule: string | undefined = await LocalStorage.getItem(currentDayString);\n  if (getSchedule === undefined) return undefined;\n\n  const schedule: Schedule = JSON.parse(getSchedule);\n  return schedule;\n}\n\nexport async function changeScheduleState(operation: string, schedule: Schedule) {\n  switch (operation) {\n    case \"caffeinate\": {\n      schedule.IsManuallyDecafed = false;\n      schedule.IsRunning = false;\n      await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n      break;\n    }\n    case \"decaffeinate\": {\n      if (schedule.IsRunning === true || isNotTodaysSchedule(schedule)) {\n        schedule.IsManuallyDecafed = true;\n        schedule.IsRunning = false;\n        await LocalStorage.setItem(schedule.day, JSON.stringify(schedule));\n      }\n      break;\n    }\n\n    default:\n      break;\n  }\n}\n\nexport function isTodaysSchedule(schedule: Schedule) {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  if (schedule.day === currentDayString) return true;\n  else return false;\n}\n\nexport function isNotTodaysSchedule(schedule: Schedule) {\n  const currentDate = new Date();\n  const currentDayString = numberToDayString(currentDate.getDay()).toLowerCase();\n\n  if (schedule.day === currentDayString) return false;\n  else return true;\n}\n\n/*\nExample usage:\nconsole.log(formatDuration(1337000)); // Output: \"15d 11h 23m 20s\"\nconsole.log(formatDuration(3600));    // Output: \"1h\"\nconsole.log(formatDuration(65));      // Output: \"1m 5s\"\nconsole.log(formatDuration(86400));   // Output: \"1d\"\n*/\nexport function formatDuration(seconds: number): string {\n  const units = [\n    { label: \"d\", value: 86400 },\n    { label: \"h\", value: 3600 },\n    { label: \"m\", value: 60 },\n    { label: \"s\", value: 1 },\n  ];\n\n  const result: string[] = [];\n\n  for (const unit of units) {\n    const amount = Math.floor(seconds / unit.value);\n    seconds %= unit.value;\n    if (amount > 0) {\n      result.push(`${amount}${unit.label}`);\n    }\n  }\n\n  return result.join(\" \");\n}\n"],
  "mappings": "yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,IAAA,eAAAC,EAAAH,GAAA,IAAAI,EAAiC,wBCAjC,IAAAC,EAAsF,wBACtFC,EAA+B,8BAsB/B,eAAsBC,EAAgBC,EAAkBC,EAAqBC,EAAyB,CAChGD,GACF,QAAM,WAAQA,CAAU,EAE1B,MAAME,EAAe,CAAE,QAAS,GAAO,OAAQ,EAAM,CAAC,KACtD,QAAK,uBAAuBC,EAAaF,CAAc,CAAC,UAAU,EAClE,MAAMG,EAAOL,EAAS,EAAI,CAC5B,CAEA,eAAsBG,EAAeH,EAAkBC,EAAqB,CACtEA,GACF,QAAM,WAAQA,CAAU,KAE1B,YAAS,qCAAqC,EAC9C,MAAMI,EAAOL,EAAS,EAAK,CAC7B,CAEA,eAAeK,EAAOL,EAAkBM,EAAsB,CACxDN,EAAQ,SACV,MAAMO,EAAiB,QAAS,CAAE,YAAAD,CAAY,CAAC,EAE7CN,EAAQ,QACV,MAAMO,EAAiB,SAAU,CAAE,YAAAD,CAAY,CAAC,CAEpD,CAEA,eAAeC,EAAiBC,EAAqBC,EAAmC,CACtF,GAAI,CACF,QAAM,iBAAc,CAAE,KAAMD,EAAa,KAAM,aAAW,WAAY,QAAAC,CAAQ,CAAC,CACjF,MAAgB,CAEhB,CACF,CAEA,SAASL,EAAaF,EAAyB,CAC7C,IAAMQ,KAAc,uBAAiC,EAC/CC,EAAO,CAAC,EAEd,OAAID,EAAY,gBAAgBC,EAAK,KAAK,GAAG,EACzCD,EAAY,aAAaC,EAAK,KAAK,GAAG,EACtCD,EAAY,eAAeC,EAAK,KAAK,GAAG,EACxCT,GAAgBS,EAAK,KAAK,IAAIT,CAAc,EAAE,EAE3CS,EAAK,OAAS,EAAI,IAAIA,EAAK,KAAK,EAAE,CAAC,GAAK,EACjD,CDhEA,eAAOC,EAA+BC,EAAiD,CACrF,GAAM,CAAE,KAAAC,CAAK,EAAID,EAAM,UACjBE,EAAU,qCAEhB,GAAI,CAACA,EAAQ,KAAKD,CAAI,EAAG,CACvB,QAAM,aAAU,QAAM,MAAM,QAAS,0BAA0B,EAC/D,MACF,CAEA,GAAM,CAAC,CAAEE,EAASC,EAAWC,CAAI,EAAIH,EAAQ,KAAKD,CAAI,GAAK,CAAC,EACtDK,EAAY,OAAOH,CAAO,EAC5BI,EAAOD,EACPD,GAAM,YAAY,GAAK,MAAQC,EAAY,KAAIC,GAAQ,IACvDF,GAAM,YAAY,GAAK,MAAQC,GAAa,KAAIC,EAAO,GAC3D,IAAMC,EAASJ,EAAY,OAAOA,CAAS,EAAI,EAE/C,GAAIG,EAAO,GAAKA,EAAO,IAAMC,EAAS,GAAKA,EAAS,GAAI,CACtD,QAAM,aAAU,QAAM,MAAM,QAAS,0BAA0B,EAC/D,MACF,CAEA,IAAMC,EAAM,IAAI,KACVC,EAAS,IAAI,KACnBA,EAAO,SAASH,CAAI,EACpBG,EAAO,WAAWF,CAAM,EACxBE,EAAO,WAAW,CAAC,EAInB,IAAMC,EAAQN,GAAQE,EAAO,IAAMJ,EAAQ,WAAW,GAAG,EACzD,KAAOO,GAAUD,GACfC,EAAO,SAASA,EAAO,SAAS,GAAKC,EAAQ,GAAK,GAAG,EAGvD,IAAMC,GAAgBF,EAAO,QAAQ,EAAID,EAAI,QAAQ,GAAK,IACpDI,EAAgBH,EAAO,mBAAmB,CAAC,EAAG,CAAE,UAAW,OAAQ,CAAC,EACpEI,EAAWJ,EAAO,QAAQ,GAAKD,EAAI,QAAQ,EAAI,eAAiB,GAEtE,MAAMM,EACJ,CAAE,QAAS,GAAM,OAAQ,EAAK,EAC9B,+BAA+BD,CAAQ,GAAGD,CAAa,GACvD,MAAMD,CAAY,EACpB,CACF",
  "names": ["caffeinateUntil_exports", "__export", "Command", "__toCommonJS", "import_api", "import_api", "import_node_child_process", "startCaffeinate", "updates", "hudMessage", "additionalArgs", "stopCaffeinate", "generateArgs", "update", "caffeinated", "tryLaunchCommand", "commandName", "context", "preferences", "args", "Command", "props", "time", "pattern", "hourStr", "minuteStr", "ampm", "inputHour", "hour", "minute", "now", "target", "is24h", "totalSeconds", "formattedTime", "tomorrow", "startCaffeinate"]
}
