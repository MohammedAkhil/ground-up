"use strict";var p=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var R=(e,t)=>{for(var n in t)p(e,n,{get:t[n],enumerable:!0})},O=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of k(t))!v.call(e,a)&&a!==n&&p(e,a,{get:()=>t[a],enumerable:!(r=M(t,a))||r.enumerable});return e};var T=e=>O(p({},"__esModule",{value:!0}),e);var N={};R(N,{default:()=>H});module.exports=T(N);var C=require("@raycast/api");var f=require("@raycast/api");async function h(e){let t=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n=e.toLowerCase(),r=/(\d{2}:\d{2})/g,a=n.match(r);if(!a||a.length<2)return await(0,f.showToast)(f.Toast.Style.Failure,"Oops! Please specify both 'from' and 'to' times in HH:MM format."),null;let[c,u]=a,o=t.filter(d=>n.includes(d));return n.includes("except")?o.length===0?(await(0,f.showToast)(f.Toast.Style.Failure,"Oops! Please mention the days to be excluded."),null):{days:t.filter(s=>!o.includes(s)),from:c,to:u}:{days:o.length>0?o:t,from:c,to:u}}var i=require("@raycast/api"),y=require("node:child_process");async function D(e,t,n){t&&await(0,i.showHUD)(t),await g({menubar:!1,status:!1}),(0,y.exec)(`/usr/bin/caffeinate ${L(n)} || true`),await b(e,!0)}async function g(e,t){t&&await(0,i.showHUD)(t),(0,y.execSync)("/usr/bin/killall caffeinate || true"),await b(e,!1)}async function b(e,t){e.menubar&&await w("index",{caffeinated:t}),e.status&&await w("status",{caffeinated:t})}async function w(e,t){try{await(0,i.launchCommand)({name:e,type:i.LaunchType.Background,context:t})}catch{}}function L(e){let t=(0,i.getPreferenceValues)(),n=[];return t.preventDisplay&&n.push("d"),t.preventDisk&&n.push("m"),t.preventSystem&&n.push("i"),e&&n.push(` ${e}`),n.length>0?`-${n.join("")}`:""}function S(e){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e]}async function x(){let t=S(new Date().getDay()).toLowerCase(),n=await i.LocalStorage.getItem(t);return n===void 0?void 0:JSON.parse(n)}var m=require("@raycast/api");async function P(e){if(!e||Object.keys(e).length===0)return!1;let t=new Date,[n,r]=e.from.split(":").map(Number),[a,c]=e.to.split(":").map(Number),u=t.getHours(),o=t.getMinutes(),l=(u>n||u===n&&o>=r)&&(u<a||u===a&&o<c);if(l===!1&&e.IsRunning===!0)return e.IsRunning=!1,await g({menubar:!0,status:!0}),await m.LocalStorage.setItem(e.day,JSON.stringify(e)),!1;if(l===!0&&e.IsRunning===!1){let d=(a-n)*3600+(c-r)*60;return await D({menubar:!0,status:!0},void 0,`-t ${d}`),e.IsRunning=!0,await m.LocalStorage.setItem(e.day,JSON.stringify(e)),!0}return!1}async function I(){let e=await x();return e===void 0||e.IsManuallyDecafed?!1:await P(e)}async function H(e){let t=await h(e.schedule);if(!t)throw new Error("Invalid schedule format. Please specify days and time range (HH:MM).");let{days:n,from:r,to:a}=t,c=n.map(s=>({day:s,from:r,to:a,IsManuallyDecafed:!1,IsRunning:!1})),o=S(new Date().getDay()).toLowerCase(),l=await I();for(let s of c)o===s.day&&(s.IsRunning=l),await C.LocalStorage.setItem(s.day,JSON.stringify(s));return`Caffeination scheduled for ${n.map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(", ")} from ${r} to ${a}`}
