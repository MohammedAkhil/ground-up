"use strict";var P=Object.defineProperty;var q=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var G=Object.prototype.hasOwnProperty;var Q=(t,e)=>{for(var n in e)P(t,n,{get:e[n],enumerable:!0})},X=(t,e,n,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of z(e))!G.call(t,r)&&r!==n&&P(t,r,{get:()=>e[r],enumerable:!(u=q(e,r))||u.enumerable});return t};var Z=t=>X(P({},"__esModule",{value:!0}),t);var te={};Q(te,{default:()=>j});module.exports=Z(te);var x=require("react"),a=require("@raycast/api");var O=require("@raycast/api"),N=require("react"),k={sunday:0,monday:1,tuesday:2,wednesday:3,thursday:4,friday:5,saturday:6};function F(t,e){(0,N.useEffect)(()=>{async function n(){e(!0);let u=await O.LocalStorage.allItems(),r=Object.values(u).map(s=>JSON.parse(s));r.length>0&&(r.sort((s,d)=>(k[s.day]??-1)-(k[d.day]??-1)),t(r)),e(!1)}n()},[t])}var c=require("@raycast/api"),p=require("react/jsx-runtime");function $({searchText:t,schedule:e,onSetScheduleAction:n,onDeleteScheduleAction:u,onPauseScheduleAction:r,onResumeScheduleAction:s}){return(0,p.jsxs)(c.ActionPanel,{children:[t.length>0&&(0,p.jsx)(c.Action,{title:"Set Schedule",icon:c.Icon.Calendar,onAction:n}),(0,p.jsx)(c.Action,{title:"Set Caffeination Schedule",icon:c.Icon.CopyClipboard,shortcut:{modifiers:["cmd"],key:"s"},onAction:()=>n()}),(0,p.jsx)(c.Action,{title:"Delete Caffeination Schedule",style:c.Action.Style.Destructive,icon:c.Icon.Trash,shortcut:c.Keyboard.Shortcut.Common.Remove,onAction:()=>u(e)}),e.IsManuallyDecafed?(0,p.jsx)(c.Action,{title:"Resume Caffeination Schedule",icon:c.Icon.Play,onAction:()=>s(e)}):(0,p.jsx)(c.Action,{title:"Pause Caffeination Schedule",icon:c.Icon.Pause,onAction:()=>r(e)})]})}var l=require("@raycast/api"),I=require("node:child_process");async function H(t,e,n){e&&await(0,l.showHUD)(e),await w({menubar:!1,status:!1}),(0,I.exec)(`/usr/bin/caffeinate ${_(n)} || true`),await J(t,!0)}async function w(t,e){e&&await(0,l.showHUD)(e),(0,I.execSync)("/usr/bin/killall caffeinate || true"),await J(t,!1)}async function J(t,e){t.menubar&&await U("index",{caffeinated:e}),t.status&&await U("status",{caffeinated:e})}async function U(t,e){try{await(0,l.launchCommand)({name:t,type:l.LaunchType.Background,context:e})}catch{}}function _(t){let e=(0,l.getPreferenceValues)(),n=[];return e.preventDisplay&&n.push("d"),e.preventDisk&&n.push("m"),e.preventSystem&&n.push("i"),t&&n.push(` ${t}`),n.length>0?`-${n.join("")}`:""}function b(t){return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t]}async function W(){let e=b(new Date().getDay()).toLowerCase(),n=await l.LocalStorage.getItem(e);return n===void 0?void 0:JSON.parse(n)}async function T(t,e){switch(t){case"caffeinate":{e.IsManuallyDecafed=!1,e.IsRunning=!1,await l.LocalStorage.setItem(e.day,JSON.stringify(e));break}case"decaffeinate":{(e.IsRunning===!0||v(e))&&(e.IsManuallyDecafed=!0,e.IsRunning=!1,await l.LocalStorage.setItem(e.day,JSON.stringify(e)));break}default:break}}function R(t){let n=b(new Date().getDay()).toLowerCase();return t.day===n}function v(t){let n=b(new Date().getDay()).toLowerCase();return t.day!==n}var D=require("@raycast/api");async function E(t){let e=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],n=t.toLowerCase(),u=/(\d{2}:\d{2})/g,r=n.match(u);if(!r||r.length<2)return await(0,D.showToast)(D.Toast.Style.Failure,"Oops! Please specify both 'from' and 'to' times in HH:MM format."),null;let[s,d]=r,m=e.filter(g=>n.includes(g));return n.includes("except")?m.length===0?(await(0,D.showToast)(D.Toast.Style.Failure,"Oops! Please mention the days to be excluded."),null):{days:e.filter(i=>!m.includes(i)),from:s,to:d}:{days:m.length>0?m:e,from:s,to:d}}var A=require("@raycast/api");async function ee(t){if(!t||Object.keys(t).length===0)return!1;let e=new Date,[n,u]=t.from.split(":").map(Number),[r,s]=t.to.split(":").map(Number),d=e.getHours(),m=e.getMinutes(),C=(d>n||d===n&&m>=u)&&(d<r||d===r&&m<s);if(C===!1&&t.IsRunning===!0)return t.IsRunning=!1,await w({menubar:!0,status:!0}),await A.LocalStorage.setItem(t.day,JSON.stringify(t)),!1;if(C===!0&&t.IsRunning===!1){let g=(r-n)*3600+(s-u)*60;return await H({menubar:!0,status:!0},void 0,`-t ${g}`),t.IsRunning=!0,await A.LocalStorage.setItem(t.day,JSON.stringify(t)),!0}return!1}async function L(){let t=await W();return t===void 0||t.IsManuallyDecafed?!1:await ee(t)}var y=require("react/jsx-runtime");function j(){let[t,e]=(0,x.useState)(""),[n,u]=(0,x.useState)(!0),[r,s]=(0,x.useState)([]);F(s,u);let d=async()=>{try{let i=await E(t);if(!i)return;let{days:f,from:o,to:h}=i,M=f.map(S=>({day:S,from:o,to:h,IsManuallyDecafed:!1,IsRunning:!1}));for(let S of M)await a.LocalStorage.setItem(S.day,JSON.stringify(S));let B=b(new Date().getDay()).toLowerCase(),V=await L(),K=M.map(S=>B===S.day?{...S,IsRunning:V}:S);s(S=>[...S.filter(Y=>!f.includes(Y.day)),...K]),await(0,a.showToast)(a.Toast.Style.Success,"Caffeination schedule set successfully."),e("")}catch(i){console.error("Failed to set schedule:",i),await(0,a.showToast)(a.Toast.Style.Failure,"Failed to set schedule.")}},m=async i=>{if(await(0,a.confirmAlert)({title:"Delete schedule",message:"Are you sure you wish to delete this schedule?",primaryAction:{title:"Yes",style:a.Alert.ActionStyle.Destructive},dismissAction:{title:"No",style:a.Alert.ActionStyle.Cancel},icon:{source:a.Icon.Trash,tintColor:a.Color.Red}}))try{i.IsRunning===!0&&await w({menubar:!0,status:!0}),await a.LocalStorage.removeItem(i.day),await(0,a.showToast)(a.Toast.Style.Success,"Schedule deleted.");let o=r.filter(h=>h.day!==i.day);s(o)}catch(o){console.error("Failed to delete schedule:",o),await(0,a.showToast)(a.Toast.Style.Failure,"Failed to delete schedule.")}},C=async i=>{T("decaffeinate",i),await(0,a.showToast)(a.Toast.Style.Success,`Schedule for ${i.day.charAt(0).toUpperCase()+i.day.slice(1).toLowerCase()} is now paused`),R(i)&&await w({menubar:!0,status:!0}),s(f=>f.map(o=>o.day===i.day?{...o,IsRunning:!1,IsManuallyDecafed:!0}:o))},g=async i=>{T("caffeinate",i),await(0,a.showToast)(a.Toast.Style.Success,`Schedule for ${i.day.charAt(0).toUpperCase()+i.day.slice(1).toLowerCase()} is now resumed`);let f=await L();s(o=>o.map(h=>h.day===i.day?{...h,IsRunning:f,IsManuallyDecafed:!1}:h))};return(0,y.jsx)(a.List,{searchText:t,isLoading:n,searchBarPlaceholder:"Schedule for Monday and Tuesday from 12:00 to 14:00",onSearchTextChange:e,filtering:!1,actions:(0,y.jsx)(a.ActionPanel,{children:(0,y.jsx)(a.Action,{autoFocus:!0,title:"Set Schedule",icon:a.Icon.Calendar,onAction:d})}),children:r.length===0?(0,y.jsx)(a.List.EmptyView,{title:"No caffeination schedules yet",description:"To schedule, enter the days to be scheduled and time range, then hit enter!",icon:a.Icon.Calendar}):(0,y.jsx)(y.Fragment,{children:["Today's Schedule","Caffeination Schedule"].map((i,f)=>(0,y.jsx)(a.List.Section,{title:i,children:r.filter(f===0?R:v).map((o,h)=>(0,y.jsx)(a.List.Item,{title:o.day.charAt(0).toUpperCase()+o.day.slice(1),accessories:[{text:f===0?o.IsRunning?"Running":o.IsManuallyDecafed?"Paused":"Scheduled":o.IsManuallyDecafed?"Scheduled Paused":"Scheduled",icon:f===0?o.IsRunning?a.Icon.Play:o.IsManuallyDecafed?a.Icon.Pause:a.Icon.Calendar:a.Icon.Calendar}],subtitle:`Set from ${o.from} to ${o.to}`,icon:a.Icon.Calendar,actions:(0,y.jsx)($,{searchText:t,schedule:o,onSetScheduleAction:d,onDeleteScheduleAction:m,onPauseScheduleAction:()=>C(o),onResumeScheduleAction:()=>g(o)})},h))},f))})})}
